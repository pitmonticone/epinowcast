<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="This function preprocesses raw observations under the
assumption they are reported as cumulative counts by a reference and
report date and is used to assign groups. It also constructs data objects
used by visualisation and modelling functions including the
observed empirical probability of a report on a given day, the cumulative
probability of report, the latest available observations, incidence of
observations, and metadata about the date of reference and report (used to
construct models). This function wraps other preprocessing functions that may
be instead used individually if required."><!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light"><script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/5/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Preprocess observations — enw_preprocess_data • epinowcast</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Preprocess observations — enw_preprocess_data"><meta property="og:description" content="This function preprocesses raw observations under the
assumption they are reported as cumulative counts by a reference and
report date and is used to assign groups. It also constructs data objects
used by visualisation and modelling functions including the
observed empirical probability of a report on a given day, the cumulative
probability of report, the latest available observations, incidence of
observations, and metadata about the date of reference and report (used to
construct models). This function wraps other preprocessing functions that may
be instead used individually if required."><meta property="og:image" content="epiforecasts.io/epinowcast/reference/figures/README-nowcast-1.png"><meta property="og:image:alt" content="An R package for hierarchical nowcasting of right censored epidemiological counts"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:creator" content="@seabbs"><meta name="twitter:site" content="@seabbs"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/5/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/5/darkly/bootstrap.css" media="(prefers-color-scheme: dark)"><!-- preferably CSS --><link rel="stylesheet" href="../preferably.css"><link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"><link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)"><script src="../darkswitch.js"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">epinowcast</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.7.1000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/germany-age-stratified-nowcasting.html">Hierarchical nowcasting of age stratified COVID-19 hospitalisations in Germany</a>
    <a class="dropdown-item" href="../articles/model.html">Model definition and implementation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/epiforecasts/epinowcast/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>

        
        <li>
          <a class="external-link nav-link" id="css-toggle-btn" aria-label="github">
            <span class="fas fa fas fa-adjust fa-lg"></span>
          </a>
        </li>
        
        
        
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Preprocess observations</h1>
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/epinowcast/blob/HEAD/R/preprocess.R" class="external-link"><code>R/preprocess.R</code></a></small>
      <div class="d-none name"><code>enw_preprocess_data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function preprocesses raw observations under the
assumption they are reported as cumulative counts by a reference and
report date and is used to assign groups. It also constructs data objects
used by visualisation and modelling functions including the
observed empirical probability of a report on a given day, the cumulative
probability of report, the latest available observations, incidence of
observations, and metadata about the date of reference and report (used to
construct models). This function wraps other preprocessing functions that may
be instead used individually if required.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">enw_preprocess_data</span><span class="op">(</span>
  <span class="va">obs</span>,
  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,
  max_delay <span class="op">=</span> <span class="fl">20</span>,
  max_delay_strat <span class="op">=</span> <span class="st">"add_to_max_delay"</span>,
  holidays <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,
  set_negatives_to_zero <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>obs</dt>
<dd><p>A data frame containing at least the following variables:
<code>reference date</code> (index date of interest), <code>report_date</code> (report date for
observations), <code>confirm</code> (cumulative observations by reference and report
date).</p></dd>


<dt>by</dt>
<dd><p>A character vector describing the stratification of
observations. This defaults to no grouping. This should be used
when modelling multiple time series in order to identify them for
downstream modelling</p></dd>


<dt>max_delay</dt>
<dd><p>Numeric defaults to 20. The maximum number of days to
include in the delay distribution. Computation scales non-linearly with this
setting so consider what maximum makes sense for your data carefully.</p></dd>


<dt>max_delay_strat</dt>
<dd><p>Character string indicating how to handle
reported cases beyond the specified maximum delay. Options include:
excluding ("exclude") and adding to the maximum delay ("add_to_max_delay").
Adding to the maximum delay is the default. Compare <code>confirm</code>, <code>max_confirm</code>,
<code>prop_reported</code> columns to understand the impact of this assumption.</p></dd>


<dt>holidays</dt>
<dd><p>A vector of dates indicating when holidays occur used by
<code><a href="enw_add_metaobs_features.html">enw_add_metaobs_features()</a></code> to treat holidays as sundays within the
<code>day_of_week</code> variable it creates internally.</p></dd>


<dt>set_negatives_to_zero</dt>
<dd><p>Logical, defaults to TRUE. Should negative
counts (for calculated incidence of observations) be set to zero. Currently
downstream modelling does not support negative counts and so setting must be
TRUE if intending to use <code><a href="epinowcast.html">epinowcast()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A data.table containing processed observations as a series of nested
data frames as well as variables containing metadata. These are:</p><ul><li><p><code>obs</code>: (observations with the addition of empirical reporting proportions
and and restricted to the specified maximum delay).</p></li>
<li><p><code>new_confirm</code>: Incidence of notifications by reference and report date.
Empirical reporting distributions are also added.</p></li>
<li><p><code>latest</code>: The latest available observations.</p></li>
<li><p><code>reporting_triangle</code>: Incident observations by report and reference date in
the standard reporting triangle matrix format.</p></li>
<li><p><code>metareference</code>: Metadata reference dates derived from observations.</p></li>
<li><p><code>metrareport</code>: Metadata for report dates.</p></li>
<li><p><code>time</code>: Numeric, number of timepoints in the data.</p></li>
<li><p><code>snapshots</code>: Numeric, number of available data snapshots to use for
nowcasting.</p></li>
<li><p><code>groups</code>: Numeric, Number of groups/strata in the supplied observations
(set using <code>by</code>).</p></li>
<li><p><code>max_delay</code>: Numeric, the maximum delay in the processed data</p></li>
<li><p><code>max_date</code>: The maximum available report date.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Preprocessing functions
<code><a href="enw_add_delay.html">enw_add_delay</a>()</code>,
<code><a href="enw_add_max_reported.html">enw_add_max_reported</a>()</code>,
<code><a href="enw_add_metaobs_features.html">enw_add_metaobs_features</a>()</code>,
<code><a href="enw_assign_group.html">enw_assign_group</a>()</code>,
<code><a href="enw_construct_data.html">enw_construct_data</a>()</code>,
<code><a href="enw_extend_date.html">enw_extend_date</a>()</code>,
<code><a href="enw_filter_obs.html">enw_filter_obs</a>()</code>,
<code><a href="enw_latest_data.html">enw_latest_data</a>()</code>,
<code><a href="enw_metadata.html">enw_metadata</a>()</code>,
<code><a href="enw_new_reports.html">enw_new_reports</a>()</code>,
<code><a href="enw_reporting_triangle_to_long.html">enw_reporting_triangle_to_long</a>()</code>,
<code><a href="enw_reporting_triangle.html">enw_reporting_triangle</a>()</code>,
<code><a href="enw_retrospective_data.html">enw_retrospective_data</a>()</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Filter example hospitalisation data to be natioanl and over all ages</span></span>
<span class="r-in"><span class="va">nat_germany_hosp</span> <span class="op">&lt;-</span> <span class="va">germany_covid19_hosp</span><span class="op">[</span><span class="va">location</span> <span class="op">==</span> <span class="st">"DE"</span><span class="op">]</span></span>
<span class="r-in"><span class="va">nat_germany_hosp</span> <span class="op">&lt;-</span> <span class="va">nat_germany_hosp</span><span class="op">[</span><span class="va">age_group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"00+"</span><span class="op">]</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Preprocess with default settings</span></span>
<span class="r-in"><span class="va">pobs</span> <span class="op">&lt;-</span> <span class="fu">enw_preprocess_data</span><span class="op">(</span><span class="va">nat_germany_hosp</span><span class="op">)</span></span>
<span class="r-in"><span class="va">pobs</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     obs           new_confirm              latest</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: &lt;data.table[3770x9]&gt; &lt;data.table[3770x11]&gt; &lt;data.table[198x8]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      reporting_triangle        metareference           metareport time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: &lt;data.table[198x22]&gt; &lt;data.table[198x10]&gt; &lt;data.table[217x11]&gt;  198</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    snapshots groups max_delay   max_date</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:       198      1        20 2021-10-20</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Preprocess using exclusion beyond the maximum delay and a max delay of 10</span></span>
<span class="r-in"><span class="va">pobs_exclude</span> <span class="op">&lt;-</span> <span class="fu">enw_preprocess_data</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">nat_germany_hosp</span>,</span>
<span class="r-in">  max_delay <span class="op">=</span> <span class="fl">10</span>, max_delay_strat <span class="op">=</span> <span class="st">"exclude"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="va">pobs_exclude</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     obs           new_confirm              latest</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: &lt;data.table[1935x9]&gt; &lt;data.table[1935x11]&gt; &lt;data.table[198x8]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      reporting_triangle        metareference           metareport time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: &lt;data.table[198x12]&gt; &lt;data.table[198x10]&gt; &lt;data.table[207x11]&gt;  198</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    snapshots groups max_delay   max_date</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:       198      1        10 2021-10-20</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Preprocess all data</span></span>
<span class="r-in"><span class="va">pobs_all</span> <span class="op">&lt;-</span> <span class="fu">enw_preprocess_data</span><span class="op">(</span></span>
<span class="r-in">  <span class="va">germany_covid19_hosp</span>,</span>
<span class="r-in">  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"location"</span>, <span class="st">"age_group"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="va">pobs_all</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                       obs             new_confirm                latest</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: &lt;data.table[448630x9]&gt; &lt;data.table[448630x11]&gt; &lt;data.table[23562x8]&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        reporting_triangle          metareference             metareport time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1: &lt;data.table[23562x22]&gt; &lt;data.table[23562x10]&gt; &lt;data.table[25823x11]&gt;  198</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    snapshots groups max_delay   max_date</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:     23562    119        20 2021-10-20</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://www.samabbott.co.uk/" class="external-link">Sam Abbott</a>, Adrian Lison.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.9000.</p>
  <p class="preferably">Using <a href="https://preferably.amirmasoudabdol.name/?source=footer" class="external-link">preferably</a> template.</p>
</div>

    </footer></div>

  

  

  </body></html>

